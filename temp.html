<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css" />
    <title>eBay + Benin Bronzes</title>
  </head>
  <body>
    <div id="root"></div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"
      integrity="sha512-b94Z6431JyXY14iSXwgzeZurHHRNkLt9d6bAHt7BZT38eqV+GyngIi/tVye4jBKPYQ2lBdRs0glww4fmpuLRwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const XEBAY_API_URL = 'https://svcs.ebay.com/'
        const XEBAY_SOA_SECURITY_APPNAME =
          'repatria-testapp-PRD-dfcc2d46c-a326c721'
        const XEBAY_SOA_GLOBAL_ID = 'EBAY-US'
        const XEBAY_SOA_OPERATION_NAME = 'findItemsByKeywords'
        const CORS_API_KEY = 'temp_02f7ba0c56f4562668570e98e47aa170'

        const searchQuery = 'Benin Bronzes'
        let searchResults = []
        let isLoading = false
        let pageNumber = 1
        let entriesPerPage = 100
        let totalPages = 0
        let hasMore = true
        let totalEntries = 0
        let showInfoPopup = false
        let activeTab = 0
        let hoveredImage = null
        let hoveredImageIndex = null

        async function find() {
          const response = await axios.get(
            `https://proxy.cors.sh/${XEBAY_API_URL}services/search/FindingService/v1?keywords=${searchQuery}&paginationInput.pageNumber=1&paginationInput.entriesPerPage=${entriesPerPage}`,
            {
              headers: {
                'X-EBAY-SOA-SECURITY-APPNAME': XEBAY_SOA_SECURITY_APPNAME,
                'X-EBAY-SOA-GLOBAL-ID': XEBAY_SOA_GLOBAL_ID,
                'X-EBAY-SOA-OPERATION-NAME': XEBAY_SOA_OPERATION_NAME,
                'x-cors-api-key': CORS_API_KEY,
              },
            }
          )

          function xmlToJson(xml) {
            const result = {}
            // Element node
            if (xml.nodeType === 1) {
              // If attributes exist, add them to the result object
              if (xml.attributes.length > 0) {
                result['@attributes'] = {}
                for (let i = 0; i < xml.attributes.length; i++) {
                  const attribute = xml.attributes[i]
                  result['@attributes'][attribute.nodeName] =
                    attribute.nodeValue
                }
              }
            } else if (xml.nodeType === 3) {
              // Text node
              return xml.nodeValue.trim()
            }

            // Process child nodes
            if (xml.hasChildNodes()) {
              for (let i = 0; i < xml.childNodes.length; i++) {
                const child = xml.childNodes[i]
                const nodeName = child.nodeName

                if (result[nodeName] === undefined) {
                  result[nodeName] = xmlToJson(child)
                } else {
                  if (result[nodeName].push === undefined) {
                    const prevValue = result[nodeName]
                    result[nodeName] = []
                    result[nodeName].push(prevValue)
                  }
                  result[nodeName].push(xmlToJson(child))
                }
              }
            }

            return result
          }

          const parser = new DOMParser()
          const xml = parser.parseFromString(response.data, 'text/xml')
          let data = xmlToJson(xml)

          console.log(data)

          let pagination = {
            pageNo:
              Number(
                data?.findItemsByKeywordsResponse?.paginationOutput?.pageNumber[
                  '#text'
                ]
              ) || 0,
            totalEntries:
              Number(
                data?.findItemsByKeywordsResponse?.paginationOutput
                  ?.totalEntries['#text']
              ) || 0,
            totalPages:
              Number(
                data?.findItemsByKeywordsResponse?.paginationOutput?.totalPages[
                  '#text'
                ]
              ) || 0,
          }

          let output =
            data?.findItemsByKeywordsResponse?.searchResult?.item || []

          output = output.map((item) => ({
            id: item?.itemId['#text'] || '',
            title: item?.title['#text'] || '',
            image:
              item?.galleryURL['#text'].replace('140.jpg', '1600.jpg') || '',
          }))

          return { output, pagination }
        }

        find()
      })
    </script>

    <!-- <script src="./script.js"></script> -->
  </body>
</html>
